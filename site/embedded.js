!function(){"use strict";var e,t;function n(){if(null==e){var t=function(){var e=window.location;"about:srcdoc"==e.href&&(e=window.parent.location);var t={};return function(e,n,i){for(;i=n.exec(e);)t[decodeURIComponent(i[1])]=decodeURIComponent(i[2])}(e.search.substring(1).replace(/\+/g,"%20"),/([^&=]+)=?([^&]*)/g),t}();e="referrer"in t?/^https:\/\/medium.com\//.test(t.referrer):!("auto"in t)}return e}function i(e){var t=e||window.innerWidth;return t>999?650:t>599?575:400}function r(e,n){if(window.top!==window.self){var i=window;if("srcdoc"==i.location.pathname&&(i=i.parent),t)return e=parseInt(e,10),void i.parent.postMessage({sentinel:"amp",type:"embed-size",height:e},"*");var r={sender:"Flourish",context:"iframe.resize",method:"resize",height:e,src:i.location.toString()};if(n)for(var o in n)r[o]=n[o];i.parent.postMessage(JSON.stringify(r),"*")}}function o(){return(-1!==navigator.userAgent.indexOf("Safari")||-1!==navigator.userAgent.indexOf("iPhone"))&&-1==navigator.userAgent.indexOf("Chrome")}function a(e){window.addEventListener("message",(function(t){if(null!=t.source&&(t.origin===document.location.origin||t.origin.match(/\/\/localhost:\d+$|\/\/flourish-api\.com$|\.flourish\.(?:local(:\d+)?|net|rocks|studio)$|\.uri\.sh$/))){var n;try{n=JSON.parse(t.data)}catch(e){return void console.warn("Unexpected non-JSON message: "+JSON.stringify(t.data))}if("Flourish"===n.sender){for(var i=document.querySelectorAll("iframe"),r=0;r<i.length;r++)if(i[r].contentWindow==t.source||i[r].contentWindow==t.source.parent)return void e(n,i[r]);console.warn("could not find frame",n)}}})),o()&&(window.addEventListener("resize",s),s())}function s(){for(var e=document.querySelectorAll(".flourish-embed"),t=0;t<e.length;t++){var n=e[t];if(!n.getAttribute("data-width")){var i=n.querySelector("iframe"),r=window.getComputedStyle(n),o=n.offsetWidth-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight);i.style.width=o+"px"}}}function d(e,t,n,r){var a;n&&"number"==typeof n?(a=n,n+="px"):n&&n.match(/^[ \t\r\n\f]*([+-]?\d+|\d*\.\d+(?:[eE][+-]?\d+)?)(?:\\?[Pp]|\\0{0,4}[57]0(?:\r\n|[ \t\r\n\f])?)(?:\\?[Xx]|\\0{0,4}[57]8(?:\r\n|[ \t\r\n\f])?)[ \t\r\n\f]*$/)&&(a=parseFloat(n)),r&&"number"==typeof r&&(r+="px");var s=document.createElement("iframe");return s.setAttribute("scrolling","no"),s.setAttribute("frameborder","0"),s.setAttribute("title","Interactive or visual content"),t.appendChild(s),n?s.style.width=n:o()?s.style.width=t.offsetWidth+"px":s.style.width="100%",!!r||(e.match(/\?/)?e+="&auto=1":e+="?auto=1",r=i(a||s.offsetWidth)+"px"),r&&("%"===r.charAt(r.length-1)&&(r=parseFloat(r)/100*t.parentNode.offsetHeight+"px"),s.style.height=r),s.setAttribute("src",e),s}!function(){var e,s=window.top===window.self,u=s?null:(t="#amp=1"==window.location.hash,{createEmbedIframe:d,isFixedHeight:n,getHeightForBreakpoint:i,startEventListeners:a,notifyParentWindow:r,isSafari:o}),l=!0;function f(){var t;Flourish.fixed_height||(null!=e?t=e:l&&(t=u.getHeightForBreakpoint()),t!==window.innerHeight&&u.notifyParentWindow(t))}function h(){f(),window.addEventListener("resize",f)}Flourish.warn=function(e){if("string"==typeof e&&(e={message:e}),s||"editor"!==Flourish.environment)console.warn(e.message);else{var t={sender:"Flourish",method:"warn",message:e.message,explanation:e.explanation};window.parent.postMessage(JSON.stringify(t),"*")}},Flourish.uploadImage=function(e){if(s||"story_editor"!==Flourish.environment)throw"Invalid upload request";var t={sender:"Flourish",method:"request-upload",name:e.name,accept:e.accept};window.parent.postMessage(JSON.stringify(t),"*")},Flourish.setHeight=function(t){Flourish.fixed_height||(e=t,l=null==t,f())},Flourish.checkHeight=function(){if(!s){var e=Flourish.__container_height;null!=e?(Flourish.fixed_height=!0,u.notifyParentWindow(e)):u.isFixedHeight()?Flourish.fixed_height=!0:(Flourish.fixed_height=!1,f())}},Flourish.fixed_height=s||u.isFixedHeight(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()}()}();
